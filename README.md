# 微信公众号爬虫 - Node.js 版本

基于 Node.js + TypeScript 的微信公众号文章爬虫工具,**零基础友好**,只需 `pnpm dev` 一个命令即可使用!

## ✨ 特性

- 🎯 **零门槛** - 交互式菜单,无需学习命令行
- 🚀 **现代技术栈** - Node.js + TypeScript + pnpm
- 🎭 **自动登录** - Playwright 自动化浏览器登录
- 💾 **灵活存储** - 本地文件 + 数据库双模式
- 🖼️ **媒体下载** - 自动下载图片和视频
- 📝 **格式转换** - 支持 HTML → Markdown
- ⚙️ **简单配置** - 引导式配置,支持注释

## 📦 快速安装

### 环境要求

- **Node.js** 16+ (推荐 18+)
- **pnpm** (自动安装)

### 三步启动

```bash
# 1. 克隆项目
git clone <项目地址>
cd wechat-spider-node

# 2. 安装 pnpm (如果未安装)
npm install -g pnpm

# 3. 安装依赖
pnpm install

# 4. 一键初始化数据库
pnpm setup

# 5. 启动交互式菜单
pnpm dev
```

就这么简单! 🎉

> **⚠️ 重要提示:** 首次运行必须先执行 `pnpm install` 和 `pnpm setup`,这会:
> - 安装项目依赖
> - 生成 Prisma Client (解决 `PrismaClient` 导出错误)
> - 初始化 SQLite 数据库

**支持系统:** ✅ Windows | ✅ macOS (已测试) | ✅ Linux

## 🚀 开始使用

### 一行命令启动交互式菜单

```bash
pnpm dev
```

会出现友好的交互式菜单:

```
🚀 欢迎使用微信公众号爬虫工具

? 请选择操作: (Use arrow keys)
❯ ⚙️  配置向导 - 生成/修改 config.json
  🔐 登录微信公众平台
  📄 爬取单个公众号
  📚 批量爬取多个公众号
  ❌ 退出
```

### 使用流程

#### 第一步: 配置向导 ⚙️

首次使用选择 `配置向导`,会引导你完成:
- 选择存储模式(本地文件/数据库/双模式)
- 是否下载图片和视频
- 设置爬取参数(间隔时间、最大页数等)

配置会自动保存到 `config.json`,下次直接使用。

#### 第二步: 登录微信 🔐

选择 `登录微信公众平台`:
1. 自动打开浏览器
2. 手机微信扫码登录
3. 登录信息保存 4 天,期间无需重复登录

#### 第三步: 开始爬取 📄

**爬取单个公众号:**
1. 选择 `爬取单个公众号`
2. 选择爬取方式(按天数/按数量/按日期范围/全部)
3. 输入公众号名称
4. 等待爬取完成

**批量爬取多个公众号:**
1. 选择 `批量爬取多个公众号`
2. 选择使用配置文件列表或手动输入
3. 设置参数后开始批量爬取

### 查看结果

**本地文件模式:**
```bash
output/
├── 公众号名称/
│   ├── 文章标题.md          # Markdown 格式
│   ├── images/              # 文章图片
│   └── metadata.json        # 元数据
```

**数据库模式:**
```bash
# 可视化查看数据库
pnpm db:studio

# 在浏览器打开 http://localhost:5555
```

## 📖 常见使用场景

### 场景 1: 个人知识库归档

**需求**: 收藏的公众号文章保存到本地,方便离线阅读

**配置**:
- 存储模式: `local` (本地文件)
- 保存格式: `markdown`
- 下载媒体: ✅ 开启

**操作**:
```bash
pnpm dev
# 选择: 爬取单个公众号 → 按天数 → 输入 30 天 → 输入公众号名
```

### 场景 2: 内容数据分析

**需求**: 批量采集多个公众号数据用于分析

**配置**:
- 存储模式: `database` (数据库)
- 下载媒体: ❌ 关闭(只需文本)

**操作**:
```bash
pnpm dev
# 选择: 批量爬取 → 使用配置文件 → 自定义参数 → 按数量 → 100 篇
```

### 场景 3: 完整备份归档

**需求**: 重要公众号的完整备份(文件+数据库)

**配置**:
- 存储模式: `both` (双模式)
- 下载媒体: ✅ 开启

**操作**:
```bash
pnpm dev
# 选择: 爬取单个公众号 → 爬取全部 → 输入公众号名
```

## ⚙️ 配置说明

配置文件 `config.json` 支持注释,项目已内置默认配置,可直接使用。

### 核心配置项

```json5
{
  "storage": {
    "mode": "local",              // 存储模式: local | database | both
    "local": {
      "baseDir": "./output",      // 输出目录
      "saveAs": "markdown",       // 保存格式: markdown | html
      "downloadMedia": true       // 是否下载图片/视频
    }
  },
  "scraper": {
    "requestInterval": 10,        // 请求间隔(秒)
    "maxPages": 10,               // 最大页数
    "days": 30                    // 默认爬取天数
  }
}
```

**修改配置:** 运行 `pnpm dev` 选择"配置向导"即可。

## 💡 进阶技巧

### 定时自动爬取

**macOS/Linux:**
```bash
# 每天凌晨 2 点自动爬取
crontab -e
# 添加: 0 2 * * * cd /path/to/wechat-spider-node && pnpm dev batch
```

**Windows:**
使用任务计划程序创建定时任务。

### 批量配置多个公众号

编辑 `config.json`:
```json5
{
  "batch": {
    "accounts": [
      "腾讯科技",
      "36氪",
      "新浪科技",
      "虎嗅网"
    ],
    "accountInterval": 10  // 每个账号间隔 10 秒
  }
}
```

然后运行:
```bash
pnpm dev
# 选择: 批量爬取 → 使用配置文件
```

## 📊 存储模式对比

| 模式 | 优点 | 缺点 | 适用场景 |
|-----|------|------|---------|
| **local** | 完整离线归档,方便分享 | 无法查询,大量文件管理困难 | 个人知识库,博客备份 |
| **database** | 高效查询,去重,分析 | 需要工具查看 | 数据分析,搜索引擎 |
| **both** | 两者优点都有 | 占用空间大 | 重要内容归档 |

## ⚠️ 注意事项

1. **请求间隔**: 建议设置合理的请求间隔(默认 10 秒),避免被微信限制
2. **登录缓存**: Token 默认有效期 4 天,过期后需要重新登录
3. **首次使用**: 运行 `pnpm dev` 后先选择"配置向导",完成基础配置
4. **媒体下载**: 大量下载可能耗时较长,建议先小范围测试
5. **数据库查看**: 使用 `pnpm db:studio` 可视化查看数据库内容

## 📂 项目结构

```
wechat-spider-node/
├── src/
│   ├── config/          # 配置管理
│   ├── wechat/          # 微信爬虫核心
│   ├── storage/         # 存储模块(本地文件 + 数据库)
│   ├── media/           # 图片/视频下载
│   ├── logger/          # 日志系统
│   └── cli/             # 交互式命令行界面
├── output/              # 本地文件输出目录
├── data/                # 数据库文件
├── logs/                # 日志文件
└── config.json          # 配置文件
```

## 🔧 常用命令

```bash
# 启动交互式菜单(最常用)
pnpm dev

# 查看数据库内容
pnpm db:studio

# 类型检查
pnpm type-check

# 构建项目
pnpm build
```

## 🚧 项目演进说明

### 📜 开发历程

本项目经历了以下演进阶段:

1. **v1.0 - 命令行脚本阶段** (初期)
   - 纯命令行参数调用
   - 适合自动化脚本和批处理

2. **v2.0 - 交互式 CLI 阶段** (当前)
   - 友好的交互式菜单
   - 降低使用门槛,适合普通用户
   - 保留命令行模式兼容性

3. **v3.0 - Web UI 界面** (规划中 🎯)
   - 现代化的 Web 管理界面
   - 可视化数据展示和统计
   - 更直观的配置和操作体验

### ⚠️ 代码现状

由于从**命令行模式**过渡到**交互式模式**,当前代码库存在一些历史遗留:

- ✅ **功能完整** - 所有核心功能正常工作
- ⚠️ **代码结构** - 部分代码混合了两种模式,可能显得不够统一
- 🔨 **持续优化** - 正在逐步重构,向 Web UI 方向演进

### 🎯 未来规划

- [ ] **代码重构** - 统一架构,分离业务逻辑和交互层
- [ ] **Web UI** - 基于 Electron 的桌面应用
- [ ] **API 服务** - 提供 RESTful API 供第三方调用
- [ ] **插件系统** - 支持自定义导出格式和数据处理

> **提示:** 如果你发现代码中有不够优雅的地方,因为我的技术不好,这是正常的!欢迎提出指正

## 📝 License

MIT

## 🙏 致谢

本项目是 [WeMediaSpider](https://github.com/seanzhang-zhichen/WeMediaSpider) Python 版本的 Node.js 重构版本。
